var isLoading,data,tocsv,fields,render,sheet,csv,empty,xls,loadfile;isLoading=function(e){return document.querySelector(".loader").className=(e?["loading"]:[]).concat(["loader"]).join(" ")},data={rows:[],headers:[],trs:[],clusterizer:null},tocsv=function(){var e,t,r,n,a;return e=data.headers,t=data.rows.filter(function(t){return e.map(function(e){return t[e]}).join("")}),e=e.filter(function(e){return t.map(function(t){return t[e]}).join("")}),r=t.map(function(t){return e.map(function(e){return t[e]+""}).join(",")}).join("\n"),r=e.map(function(e){return'"'+e+'"'}).join(",")+"\n"+r,n=URL.createObjectURL(new Blob([r],{type:"text/csv"})),a=document.getElementById("download-link"),a.setAttribute("href",n),a.style.display="block"},fields=function(){var e,t,r,n,a,o,d,s,i,l=[];for(e=data.headers,t=e.map(function(e){var t;return t={name:e,data:[]}}),r=0,n=data.rows.length;n>r;++r){for(a=r,o=[],d=0,s=e.length;s>d;++d)i=d,o.push(t[i].data.push(data.rows[a][e[i]]));l.push(o)}return l},render=function(){var head,scroll,content,h,w,trs,that;return head=document.querySelector("#sheet .sheet-head"),scroll=document.querySelector("#sheet .clusterize-scroll"),content=document.querySelector("#sheet .clusterize-content"),content.innerHTML="",h=data.headers,w=100/h.length+"%",h.length>10&&(w="10%"),trs=data.rows.map(function(e,t){return"<div>"+h.map(function(r,n){return"<div contenteditable='true' row='"+t+"' col='"+n+"' style='width:"+w+"'>"+(e[r]||"")+"</div>"}).join("")+"</div>"}),head.innerHTML="<div>"+data.headers.map(function(e){return"<div style='width:"+w+"'>"+e+"</div>"}).join("")+"</div>",(that=data.clusterizer)&&that.destroy(!0),data.clusterizer=new Clusterize({rows:trs,scrollElem:scroll,contentElem:content}),isLoading(!1),scroll.addEventListener("scroll",function(){return head.scrollLeft=scroll.scrollLeft}),content.addEventListener("click",function(e){return setTimeout(function(){var t,r,n,a;return t=e.target,r=+t.getAttribute("row"),n=+t.getAttribute("col"),a=data.rows[r][data.headers[n]],document.getElementById("input").value=a},0)}),content.addEventListener("keydown",function(e){return setTimeout(function(){var n,val,row,col,d,re,grid,ret,str,num,VR,VC,i$,to$,i,err;if(n=e.target,val=n.textContent,row=+n.getAttribute("row"),col=+n.getAttribute("col"),data.rows[row][data.headers[col]]=d=val,document.getElementById("input").value=d,re=/([A-Z]+[0-9]*)/g,/^=/.exec(d)){for(grid={};ret=re.exec(d),ret;){for(val=ret[1],str=/([A-Z]+)/.exec(val)[1],num=/([0-9]+)/.exec(val)[1],VR=+num-1,VC=0,i$=0,to$=str.length;to$>i$;++i$)i=i$,VC=26*VC+(str.charCodeAt(i)-65);grid[val]=data.rows[VR][data.headers[VC]],isNaN(+grid[val])||(grid[val]=+grid[val])}d=d.replace(/([A-Z]+)/g,"grid.$1"),d=d.replace(/^=/,"");try{ret=eval(d)}catch(e$){err=e$}return data.rows[row][data.headers[col]]=d=ret,document.getElementById("input").value=ret}},0)})},sheet=function(e){var t,r;return t=e.result.values,data.headers=r=t[0],t.splice(0,1),data.rows=t.map(function(e){var t,n,a,o;for(t={},n=0,a=e.length;a>n;++n)o=n,t[r[o]]=e[o];return t}),console.log("[Sheet] "+data.rows.length+" rows imported."),render()},csv=function(e){return isLoading(!0),Papa.parse(e,{worker:!0,header:!0,step:function(e){var t;return t=e.data,data.rows.push.apply(data.rows,t)},complete:function(){var e,t;e=[];for(t in data.rows[0]||{})e.push(t);return data.headers=e,console.log("[CSV] "+data.rows.length+" rows imported."),render()}})},empty=function(){function e(){var e,t=[];for(e=0;10>e;++e)n=e,t.push('"'+n+'": ""');return t}var t,r,n,a;for(t=[],r=0;10>r;++r)n=r,t.push(n);for(data.headers=t,t=[],r=0;100>r;++r)a=r,t.push(JSON.parse("{"+e().join(",")+"}"));return data.rows=t,console.log(data.rows),render()},xls=function(e){var t,r,n,a,o;return isLoading(!0),t=XLSX.read(e,{type:"binary"}),r=t.Sheets[t.SheetNames[0]],n=XLSX.utils.sheet_to_json(r),data.headers=a=function(){var e=[];for(o in n[0]||{})e.push(o);return e}(),data.rows=n,data.rows.map(function(e){var t,r=[];for(t in a)null==e[t]&&r.push(e[t]="");return r}),console.log("[Excel] "+n.length+" rows imported."),render()},loadfile=function(){var e,t;return e=document.getElementById("file"),e.files.length?(t=new FileReader,t.onload=function(){var r,n,a;return data.rows=[],data.headers=[],data.trs=[],r=[e.files[0].name,t.result],n=r[0],a=r[1],/\.csv$/.exec(n)&&csv(a),/\.xlsx?$/.exec(n)?xls(a):void 0},t.readAsBinaryString(e.files[0])):void 0},empty();