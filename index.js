var isLoading,data,tocsv,fields,render,sheet,csv,xls,loadfile;isLoading=function(e){return document.querySelector(".loader").className=(e?["loading"]:[]).concat(["loader"]).join(" ")},data={rows:[],headers:[],trs:[],clusterizer:null},tocsv=function(){var e,t,r,n;return e=data.headers,t=data.rows.map(function(t){return e.map(function(e){return t[e]+""}).join(",")}).join("\n"),t=e.map(function(e){return'"'+e+'"'}).join(",")+"\n"+t,r=URL.createObjectURL(new Blob([t],{type:"text/csv"})),n=document.getElementById("download-link"),n.setAttribute("href",r),n.style.display="block"},fields=function(){var e,t,r,n,a,o,d,s,i,u=[];for(e=data.headers,t=e.map(function(e){var t;return t={name:e,data:[]}}),r=0,n=data.rows.length;n>r;++r){for(a=r,o=[],d=0,s=e.length;s>d;++d)i=d,o.push(t[i].data.push(data.rows[a][e[i]]));u.push(o)}return u},render=function(){var e,t,r,n,a,o,d;return e=document.querySelector("#sheet .sheet-head"),t=document.querySelector("#sheet .clusterize-scroll"),r=document.querySelector("#sheet .clusterize-content"),r.innerHTML="",n=data.headers,a=100/n.length+"%",n.length>10&&(a="10%"),o=data.rows.map(function(e,t){return"<div>"+n.map(function(r,n){return"<div contenteditable='true' row='"+t+"' col='"+n+"' style='width:"+a+"'>"+(e[r]||"")+"</div>"}).join("")+"</div>"}),e.innerHTML="<div>"+data.headers.map(function(e){return"<div style='width:"+a+"'>"+e+"</div>"}).join("")+"</div>",(d=data.clusterizer)&&d.destroy(!0),data.clusterizer=new Clusterize({rows:o,scrollElem:t,contentElem:r}),isLoading(!1),t.addEventListener("scroll",function(){return e.scrollLeft=t.scrollLeft}),r.addEventListener("click",function(e){return setTimeout(function(){var t,r,n,a;return t=e.target,r=+t.getAttribute("row"),n=+t.getAttribute("col"),a=data.rows[r][data.headers[n]],document.getElementById("input").value=a},0)}),r.addEventListener("keydown",function(e){return setTimeout(function(){var t,r,n,a,o;return t=e.target,r=t.textContent,n=+t.getAttribute("row"),a=+t.getAttribute("col"),data.rows[n][data.headers[a]]=o=r,document.getElementById("input").value=o},0)})},sheet=function(e){var t,r;return t=e.result.values,data.headers=r=t[0],t.splice(0,1),data.rows=t.map(function(e){var t,n,a,o;for(t={},n=0,a=e.length;a>n;++n)o=n,t[r[o]]=e[o];return t}),console.log("[Sheet] "+data.rows.length+" rows imported."),render()},csv=function(e){return isLoading(!0),Papa.parse(e,{worker:!0,header:!0,step:function(e){var t;return t=e.data,data.rows.push.apply(data.rows,t)},complete:function(){var e,t;e=[];for(t in data.rows[0]||{})e.push(t);return data.headers=e,console.log("[CSV] "+data.rows.length+" rows imported."),render()}})},xls=function(e){var t,r,n,a,o;return isLoading(!0),t=XLSX.read(e,{type:"binary"}),r=t.Sheets[t.SheetNames[0]],n=XLSX.utils.sheet_to_json(r),data.headers=a=function(){var e=[];for(o in n[0]||{})e.push(o);return e}(),data.rows=n,data.rows.map(function(e){var t,r=[];for(t in a)null==e[t]&&r.push(e[t]="");return r}),console.log("[Excel] "+n.length+" rows imported."),render()},loadfile=function(){var e,t;return e=document.getElementById("file"),e.files.length?(t=new FileReader,t.onload=function(){var r,n,a;return data.rows=[],data.headers=[],data.trs=[],r=[e.files[0].name,t.result],n=r[0],a=r[1],/\.csv$/.exec(n)&&csv(a),/\.xlsx?$/.exec(n)?xls(a):void 0},t.readAsBinaryString(e.files[0])):void 0};